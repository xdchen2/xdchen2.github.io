var jsPsychExtensionWebgazer=function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}var a=t((function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t,this.currentTrialData=[],this.currentTrialTargets={},this.initialized=!1,this.activeTrial=!1,this.initialize=function(e){var t=e.round_predictions,n=void 0===t||t,a=e.auto_initialize,i=void 0!==a&&a,o=e.sampling_interval,s=void 0===o?34:o,c=e.webgazer;return r.round_predictions=n,r.sampling_interval=s,r.gazeUpdateCallbacks=[],r.domObserver=new MutationObserver(r.mutationObserverCallback),new Promise((function(e,t){void 0===c?window.webgazer?r.webgazer=window.webgazer:t(new Error("Webgazer extension failed to initialize. webgazer.js not loaded. Load webgazer.js before calling initJsPsych()")):r.webgazer=c,r.hideVideo(),r.hidePredictions(),i?r.webgazer.begin().then((function(){r.initialized=!0,r.stopMouseCalibration(),r.pause(),e()})).catch((function(e){console.error(e),t(e)})):e()}))},this.on_start=function(e){r.currentTrialData=[],r.currentTrialTargets={},r.currentTrialSelectors=e.targets,r.domObserver.observe(r.jsPsych.getDisplayElement(),{childList:!0})},this.on_load=function(){r.currentTrialStart=performance.now(),r.startSampleInterval(),r.activeTrial=!0},this.on_finish=function(){return r.stopSampleInterval(),r.domObserver.disconnect(),r.activeTrial=!1,{webgazer_data:r.currentTrialData,webgazer_targets:r.currentTrialTargets}},this.start=function(){return new Promise((function(e,t){if(void 0===r.webgazer){var n="Failed to start webgazer. Things to check: Is webgazer.js loaded? Is the webgazer extension included in initJsPsych?";console.error(n),t(n)}r.webgazer.begin().then((function(){r.initialized=!0,r.stopMouseCalibration(),r.pause(),e()})).catch((function(e){console.error(e),t(e)}))}))},this.startSampleInterval=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.sampling_interval;r.gazeInterval=setInterval((function(){r.webgazer.getCurrentPrediction().then(r.handleGazeDataUpdate)}),e),r.webgazer.getCurrentPrediction().then(r.handleGazeDataUpdate)},this.stopSampleInterval=function(){clearInterval(r.gazeInterval)},this.isInitialized=function(){return r.initialized},this.faceDetected=function(){return r.webgazer.getTracker().predictionReady},this.showPredictions=function(){r.webgazer.showPredictionPoints(!0)},this.hidePredictions=function(){r.webgazer.showPredictionPoints(!1)},this.showVideo=function(){r.webgazer.showVideo(!0),r.webgazer.showFaceOverlay(!0),r.webgazer.showFaceFeedbackBox(!0)},this.hideVideo=function(){r.webgazer.showVideo(!1),r.webgazer.showFaceOverlay(!1),r.webgazer.showFaceFeedbackBox(!1)},this.resume=function(){r.webgazer.resume()},this.pause=function(){r.webgazer.pause(),document.querySelector("#webgazerGazeDot")&&(document.querySelector("#webgazerGazeDot").style.display="none")},this.resetCalibration=function(){r.webgazer.clearData()},this.stopMouseCalibration=function(){r.webgazer.removeMouseEventListeners()},this.startMouseCalibration=function(){r.webgazer.addMouseEventListeners()},this.calibratePoint=function(e,t){r.webgazer.recordScreenPosition(e,t,"click")},this.setRegressionType=function(e){["ridge","weightedRidge","threadedRidge"].includes(e)?r.webgazer.setRegression(e):console.warn("Invalid regression_type parameter for webgazer.setRegressionType. Valid options are ridge, weightedRidge, and threadedRidge.")},this.getCurrentPrediction=function(){return r.webgazer.getCurrentPrediction()},this.onGazeUpdate=function(e){return r.gazeUpdateCallbacks.push(e),function(){r.gazeUpdateCallbacks=r.gazeUpdateCallbacks.filter((function(t){return t!==e}))}},this.handleGazeDataUpdate=function(e,t){if(null!==e){var n={x:r.round_predictions?Math.round(e.x):e.x,y:r.round_predictions?Math.round(e.y):e.y,t:e.t};r.activeTrial&&(n.t=Math.round(e.t-r.currentTrialStart),r.currentTrialData.push(n)),r.currentGaze=n;for(var a=0;a<r.gazeUpdateCallbacks.length;a++)r.gazeUpdateCallbacks[a](n)}else r.currentGaze=null},this.mutationObserverCallback=function(e,t){var a,i=n(r.currentTrialSelectors);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!r.currentTrialTargets[o]&&r.jsPsych.getDisplayElement().querySelector(o)){var s=r.jsPsych.getDisplayElement().querySelector(o).getBoundingClientRect();r.currentTrialTargets[o]=s}}}catch(e){i.e(e)}finally{i.f()}}}));return a.info={name:"webgazer"},a}();
//# sourceMappingURL=index.browser.min.js.map