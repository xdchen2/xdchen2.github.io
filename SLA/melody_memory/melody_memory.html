<html>
<head>
    <script src="http://code.jquery.com/jquery-1.6.2.js" type="text/javascript"></script>
    <title>Melody memory</title>
    <style type="text/css">
    h1 {text-align: center;}
    p {text-align: center;}
    .hidden 
    {
    	display: none;
    }
    button
    {
    	position: relative
		width: 150px;
    	color: #444444;
    	background-color: LightGray;
    	font-size: 1.2em;
    }
    .button1
    {
    	background-color: LightGray;
    	font-size: 40px;
    }
	.buttonbox
    {
        position: relative;
        top: 400px;
        margin: auto;
    }
    .playbutton
    {
    	position: relative;
    	top: 250 px;
    	margin: auto;
    }
    </style>
</head>
<body>
    <header id="instructions1">
    <h1>In this test you will hear some melodies. Each melody will repeat three times. Try to remember them, then repeat them back.</h1>
	</header>
	<header id="instructions2">
    <h1>Press the button below to hear what one melody might sound like. If your volume is too soft or too loud, adjust it and play the melody again.</h1>
	</header>
	<header id="instructions3">
    <h1>When the melody is finished playing, you will repeat it by clicking on these five boxes. Whenever you click on a box, it will play the tone with which it's associated. Try clicking on them!</h1>
	</header>
	<header id="instructions4">
    <h1>One final clue: the first note of a melody will ALWAYS be a 3. Press the button below when you're ready to start!</h1>
	</header>
	<header id="trial">
    <h1>Repeat the melody</h1>
      <p>When the melody is finished playing, repeat it by clicking on these five boxes.</p>
	</header>
	<header id="questions">
	<div style="text-align:center;">
	  What is your subject id?<br>
	  <br>
	 <input type="text" id="ID" value=""><br>
	</div>
	</header>
	<header id="thanks">
	<h1>Thanks!</h1>
	<p>Thank you! The experiment is concluded.</p>
	</header>
	<div class="buttonbox" style="text-align:center;">
    <button type="button" id="restartButton">Start next trial</button>
	</div>
	<div class="buttonbox" style="text-align:center;">
    <button type="button" id="Continue1">Continue</button>
	</div>
	<div class="buttonbox" style="text-align:center;">
    <button type="button" id="Continue2">Continue</button>
	</div>
	<div class="buttonbox" style="text-align:center;">
    <button type="button" id="Continue3">Continue</button>
	</div>
	<div class="buttonbox" style="text-align:center;">
    <button type="button" id="submitButton">Submit answers</button>
	</div>
	<div class="playbutton" style="text-align:center;">
    <button type="button" id="playButton">Play sample melody</button>
	</div>
	<div style="text-align: center;">
    <button class = "button1" type="button" id="5Button">5</button>
    </div>  
    <div style="text-align: center;">
    <button class = "button1" type="button" id="4Button">4</button>
    </div>
    <div style="text-align: center;">
    <button class = "button1" type="button" id="3Button">3</button>
    </div>
    <div style="text-align: center;">
    <button class = "button1" type="button" id="2Button">2</button>
    </div>
    <div style="text-align: center;">
    <button class = "button1" type="button" id="1Button">1</button>
    </div>

    <script type="text/javascript">
    
    var response_array = [[],[],[],[],[],[],[],[],[],[]];
    var trial_number = 1;
    
    var during_instructions = 1;
    
    var memory_score = 0;
    
    var correct_answers = [];
    correct_answers[0] = ["3", "2", "1", "1", "2", "3", "2"];
    correct_answers[1] = ["3", "4", "3", "4", "5", "4", "3"];
    correct_answers[2] = ["3", "4", "5", "4", "3", "2", "1"];
    correct_answers[3] = ["3", "2", "1", "2", "3", "2", "1"];
    correct_answers[4] = ["3", "4", "5", "5", "5", "5", "4"];
    correct_answers[5] = ["3", "4", "5", "4", "3", "2", "3"];
    correct_answers[6] = ["3", "2", "3", "2", "3", "2", "3"];
    correct_answers[7] = ["3", "2", "3", "4", "3", "2", "1"];
    correct_answers[8] = ["3", "4", "5", "4", "5", "4", "5"];
    correct_answers[9] = ["3", "4", "3", "2", "1", "1", "2"];
	
	var audio_array = [];
	var audio_files = [];
	
	for (var i = 1; i < 12; i++) {
        var stim_sound = (i.toString() + ".flac");
        var toAppend = '<audio id="track' + i.toString() + '"><source src="' + stim_sound + '" /></audio>';
        $('body').append(toAppend);
    }
    
	for (var i = 1; i < 6; i++) {
        var stim_sound = ("note" + i.toString() + ".flac");
        var toAppend = '<audio id="note' + i.toString() + '"><source src="' + stim_sound + '" /></audio>';
        $('body').append(toAppend);
    }

	
	
	$(document).ready(function () {
		$('#questions').show();
		$('#instructions1').hide();
		$('#instructions2').hide();
		$('#instructions3').hide();
		$('#instructions4').hide();
		$('#thanks').hide();
		$('#trial').hide();
		$('#restartButton').hide();
		$('#playButton').hide();
		$('#playButton').click(playDemo);
		$('#1Button').hide();
		$('#2Button').hide();
		$('#3Button').hide();
		$('#4Button').hide();
		$('#5Button').hide();
		$('#Continue1').hide();
		$('#Continue2').hide();
		$('#Continue3').hide();
		$('#Continue1').click(Continue1);
		$('#Continue2').click(Continue2);
		$('#Continue3').click(Continue3);
		$('#submitButton').show();
		$('#submitButton').click(init);
		$('#restartButton').click(start);
		$('#1Button').click(one);
		$('#2Button').click(two);
		$('#3Button').click(three);
		$('#4Button').click(four);
		$('#5Button').click(five);
    });
    
    function playDemo() {
    
    	x = document.getElementById('track11');
    	x.play();
    
    }
    
    function init() {

		subject_ID = document.getElementById("ID").value;
		$('#submitButton').hide();
		$('#Continue1').show();
		$('#instructions1').show();
		$('#questions').hide();
		}
		
	function Continue1() {
	
		$('#Continue1').hide();
		$('#Continue2').show();
		$('#instructions1').hide();
		$('#instructions2').show();
		$('#playButton').show();
	
	}
	
	function Continue2() {
	
		$('#playButton').hide();		
		$('#Continue2').hide();
		$('#Continue3').show();
		$('#instructions2').hide();
		$('#instructions3').show();
		$('#1Button').show();
		$('#2Button').show();
		$('#3Button').show();
		$('#4Button').show();
		$('#5Button').show();
	
	}
	
	function Continue3() {
	
		$('#Continue3').hide();
		$('#restartButton').show();
		$('#instructions3').hide();
		$('#instructions4').show();
		$('#1Button').hide();
		$('#2Button').hide();
		$('#3Button').hide();
		$('#4Button').hide();
		$('#5Button').hide();
	
	}
	
	function save_data() {
	
	var testString = "";
	testString += "Melody memory score: "
	
	for (var i = 1; i < 11; i++) {
	
		var current_vector = response_array[i-1];
		var current_correct = correct_answers[i-1];
		
		while (current_vector.length < 7) {
		
			current_vector.push('0');
		
		}
		
		current_vector = current_vector.slice(0,7);
		
		for(var j = 1; j < 8; j++) {
		
			if (current_vector[j-1] == current_correct[j-1]) {
			
				memory_score += 1;
			
			}
		
		}
		
	
	}

	memory_score = memory_score / 70;
	memory_score = memory_score * 100;
	
	testString += memory_score.toString();
	var fileContent = testString;
	var bb = new Blob([fileContent ], { type: 'text/plain' });
	var a = document.createElement('a');
	a.download = subject_ID;
	a.download += '_melody_memory.txt';
	a.href = window.URL.createObjectURL(bb);
	a.click();
	$('#restartButton').hide();
	$('#trial').hide();
	$('#1Button').hide();
	$('#2Button').hide();
	$('#3Button').hide();
	$('#4Button').hide();
	$('#5Button').hide();
	$('#thanks').show();
	}
	
	function start() {
	
		during_instructions = 0;
	
		if (trial_number > 10) {
	
			save_data()
	
		}
	
		else {
	
			$('#restartButton').hide();
			$('#instructions4').hide();
			$('#1Button').hide();
			$('#2Button').hide();
			$('#3Button').hide();
			$('#4Button').hide();
			$('#5Button').hide();
			$('#trial').show();
		
        	z = document.getElementById('track' + trial_number.toString());
        	z.play();
			z.onended = function () {
				timeoutID = window.setTimeout(function(){
				$('#1Button').show();
				$('#2Button').show();
				$('#3Button').show();
				$('#4Button').show();
				$('#5Button').show();
				$('#restartButton').show();
				trial_number += 1;
				},500);
			}
		
			}
		}
	
	function one() {
	
		if (during_instructions < 1) {
	
			response_array[trial_number-2].push('1');
		
		}
		
		x = document.getElementById('note1');
		x.play();
		
	}
	
	function two() {
	
		if (during_instructions < 1) {
	
			response_array[trial_number-2].push('2');
		
		}
		
		x = document.getElementById('note2');
		x.play();
		
	}
	
	function three() {
	
		if (during_instructions < 1) {
	
			response_array[trial_number-2].push('3');
		
		}
		
		x = document.getElementById('note3');
		x.play();
		
	}
	
	function four() {
	
		if (during_instructions < 1) {
	
			response_array[trial_number-2].push('4');
		
		}
		
		x = document.getElementById('note4');
		x.play();
		
	}
	
	function five() {
	
		if (during_instructions < 1) {
	
			response_array[trial_number-2].push('5');
		
		}
		
		x = document.getElementById('note5');
		x.play();
		
	}

    </script>
</body>
</html>